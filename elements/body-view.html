<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/observe-js/observe-js.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="genre-list.html">
<link rel="import" href="main-view.html">

<dom-module id="body-view">
    <style>
        #navBar {
            top: 0px;
            left: 0px;
            height: 50px;
            width: 100%
        }

        #navBar::shadow .paper-toolbar {
            height: 50px;
            margin: 0px;
            padding: 0px;
        }

        #drawerPanel {
            top:50px;
            height: calc(100% - 50px);
        }
    </style>
    
    <template>
        <paper-toolbar id="navBar">
            <paper-button id="genreButton">Genres</paper-button>
            <paper-button>Season</paper-button>
        </paper-toolbar>
        <paper-drawer-panel id="drawerPanel" force-narrow="true">
            <div drawer style="overflow-y:auto;">
                <iron-pages id="sidebarSelector" attr-for-selected="id">
                    <genre-list id="genres" selected-genres="{{selectedGenres}}"></genre-list>
                </iron-pages>
            </div>
            <main-view main id="mainView">Main</main-view>
        </paper-drawer-panel>
        
    </template>
</dom-module>

<script>
    Polymer({
        is: 'body-view',
        drawerView: "",
        properties: {
            selectedGenres: {
                type: "array",
                notify: true,
                observer: "genresObserver"
            },
        },
        
        ready: function() {
            this.registerButtonHandlers();
        },
        
        //Because I can't get 
        genresObserver: function(newV,oldV) {
            if (typeof oldV !== 'undefined') {
                oldV.observer.close();
            }
            var onSelectionChanged = function(changes) {
            }.bind(this);
            newV.observer = new ArrayObserver(newV);
            newV.observer.open(onSelectionChanged);
        },
        
        registerButtonHandlers: function() {
            this.$.genreButton.onclick = function() {
                this.onSidebarButtonClick("genres");
            }.bind(this);
        },
        
        onSidebarButtonClick: function(button) {
            var drawerOpen = (this.$.drawerPanel.selected === 'drawer');
            if (drawerOpen && this.$.sidebarSelector.selected === button) {
                this.$.drawerPanel.closeDrawer();
                return;
            }
            switch(button) {
                case "genres":
                    this.$.sidebarSelector.selected = button;
                    break;
            }
            this.$.drawerPanel.openDrawer();
        },
    });
</script>