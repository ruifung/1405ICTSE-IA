<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-material/paper-material.html">
<link rel="import" href="../bower_components/neon-animation/animations/slide-from-right-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/slide-right-animation.html">
<link rel="import" href="../bower_components/paper-styles/paper-styles.html">

<dom-module id="anime-details">
    <style>

        #dialog {
            display: flex;
            box-shadow: none;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0);
            justify-content: center;
            
        }
        #dialogContent {
            display: inline-block;
            pointer-events: auto;
            margin-top: auto;
            margin-bottom: auto;
            padding: 0;
            background-color: var(--google-green-300);
            max-height: 80%;
            max-width: 80%;
            word-wrap: break-word;       /* Internet Explorer 5.5+ */
            word-break: break-all;
            white-space: normal;
        }
        
        @media (max-width: 1100px) {
            #dialogContent {
                width: 80%;
                height: 80%;
            }
            #dialogContent > img {
                max-width: 50%;
            }
            #title {
                @apply(--paper-font-subhead)
            }
        }
        
        @media (min-width: 1100px) {
            #dialogContent {
                width: 70%;
                height: 70%;
            }
            #dialogContent > img {
                max-width: 30%;
            }
            #title {
                @apply(--paper-font-title)
            }
        }
        
        #dialogContent > img {
            width: auto;
            height: 100%;
            max-height: 100%;
            background-color: white;
            float: left;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        
        #title {
            white-space: normal !important;
        }
    </style>
    <template>
        <paper-dialog id="dialog"
                      with-backdrop entry-animation="slide-from-right-animation"
                      exit-animation="slide-right-animation">
            <paper-material id="dialogContent" elevation="5">
                <img src="[[anime.image_url_lge]]">
                <p>
                    <span id="title">[[anime.title_romaji]]</span><br>
                    <span id="jptitle">Japanese Title: <span>[[anime.title_japanese]]</span></span><br>
                    <span id="altNames">Alternative Names: <span>[[altNames]]</span></span><br>
                    <span id="airStatus">Airing Status: <span>[[anime.airing_status]]</span></span><br>
                    <span id="classification">Age Rating: <span>[[classification]]</span></span><br>
                </p>
            </paper-material>
        </paper-dialog>
    </template>
</dom-module>
<script>
    Polymer({
        is: "anime-details",
        properties: {
            animeId: {
                type: Number
            },
            anime: {
                type: Object,
                notify: true
            },
            altNames: {
                type: String,
                computed: "_getAltNames(anime)"
            },
            classification: {
                type: String,
                computed: "_getClassification(anime)"
            }
        },
        listeners: {
            click: "_clickHandler"
        },
        ready: function() {
            this.close();
        },
        
        _getClassification: function(anime) {
            if (!anime.classification) {
                return "No rating available";
            }
            if (anime.classification.length === 0) {
                return "No rating available";
            };
            return anime.classification;
        },
        
        _getAltNames: function(anime) {
            if(anime === undefined) {
                return;
            }
            var str = ""
            console.log(anime);
            if (anime.title_english !== anime.title_romaji) {
                str = str + anime.title_english;
            }
            if (anime.synonyms.length > 0) {
                if (str !== "") {
                    str = str + " ,";
                }
                var synonyms = anime.synonyms.slice(0)
                while (synonyms.length > 0) {
                    str = str + synonyms.shift();
                    if (synonyms.length > 0) {
                        str = str + " ,";
                    }
                }
            }
            if (str === "") {
                str = "None";
            }
            return str;
        },
        //METHODS
        open: function(anime) {
            this.anime = anime;
            this.$.dialog.open();
        },
        close: function() {
            this.$.dialog.close();
        },
        cancel: function() {
            this.$.dialog.cancel();
        },
        _clickHandler: function(e) {
            if(e.target === this.$.dialog) {
                this.$.dialog.cancel();
            }
        },
    });
</script>